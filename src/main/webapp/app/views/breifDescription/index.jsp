<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html>
<head>
  <title>Title</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
<div id="toast-success" class="absolute right-2 -top-2 flex items-center p-4 mb-4 w-full max-w-xs text-gray-500 rounded-lg shadow" role="alert"></div>
<div class="p-6 mt-8">
  <div class="overflow-x-auto relative sm:rounded-lg px-6">
    <div class="grid grid-cols-3 gap-2">
      <%--     start card breif--%>
        <div class="max-w-sm bg-white rounded-lg border border-gray-200 shadow-md">
          <a href="#">
            <img class="rounded-t-lg w-full h-48 border" src="/assets/logo.svg" alt="" />
          </a>
          <div class="p-5">
            <a href="#">
              <h5 class="mb-2 text-1xl font-bold tracking-tight text-gray-900">Noteworthy technology acquisitions</h5>
            </a>
            <p class="mb-3 font-normal text-gray-700">Here are the biggest enterprise.</p>
            <a href="/learner/breifs-description" class="inline-flex items-center py-2 px-3 text-sm font-medium text-center text-white bg-blue-700 rounded-lg hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300">
              Read more
              <svg aria-hidden="true" class="ml-2 -mr-1 w-4 h-4" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
            </a>
          </div>
        </div>
      <%--     end card breif--%>
        <%--     start card breif--%>
        <div class="max-w-sm bg-white rounded-lg border border-gray-200 shadow-md">
          <a href="#">
            <img class="rounded-t-lg w-full h-48 border" src="/assets/logo.svg" alt="" />
          </a>
          <div class="p-5">
            <a href="#">
              <h5 class="mb-2 text-1xl font-bold tracking-tight text-gray-900">Noteworthy technology acquisitions</h5>
            </a>
            <p class="mb-3 font-normal text-gray-700">Here are the biggest enterprise.</p>
            <a href="/learner/breifs-description" class="inline-flex items-center py-2 px-3 text-sm font-medium text-center text-white bg-blue-700 rounded-lg hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300">
              Read more
              <svg aria-hidden="true" class="ml-2 -mr-1 w-4 h-4" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
            </a>
          </div>
        </div>
      <%--     end card breif--%>
        <%--     start card breif--%>
        <div class="max-w-sm bg-white rounded-lg border border-gray-200 shadow-md">
          <a href="#">
            <img class="rounded-t-lg w-full h-48 border" src="/assets/logo.svg" alt="" />
          </a>
          <div class="p-5">
            <a href="#">
              <h5 class="mb-2 text-1xl font-bold tracking-tight text-gray-900">Noteworthy technology acquisitions</h5>
            </a>
            <p class="mb-3 font-normal text-gray-700">Here are the biggest enterprise.</p>
            <a href="/learner/breifs-description" class="inline-flex items-center py-2 px-3 text-sm font-medium text-center text-white bg-blue-700 rounded-lg hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300">
              Read more
              <svg aria-hidden="true" class="ml-2 -mr-1 w-4 h-4" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
            </a>
          </div>
        </div>
        <%--     end card breif--%>
        <%--     start card breif--%>
        <div class="max-w-sm bg-white rounded-lg border border-gray-200 shadow-md">
          <a href="#">
            <img class="rounded-t-lg w-full h-48 border" src="/assets/logo.svg" alt="" />
          </a>
          <div class="p-5">
            <a href="#">
              <h5 class="mb-2 text-1xl font-bold tracking-tight text-gray-900">Noteworthy technology acquisitions</h5>
            </a>
            <p class="mb-3 font-normal text-gray-700">Here are the biggest enterprise.</p>
            <a href="/learner/breifs-description" class="inline-flex items-center py-2 px-3 text-sm font-medium text-center text-white bg-blue-700 rounded-lg hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300">
              Read more
              <svg aria-hidden="true" class="ml-2 -mr-1 w-4 h-4" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
            </a>
          </div>
        </div>
        <%--     end card breif--%>
    </div>
  </div>
</div>
<script>
  // hide elemment when loading page
  $("#toast-success").hide()
  $("#loadingUpdate").hide()
  $("#loadingNotes").hide()
  // get promotion
  // getPromotion()
  function getPromotion() {
    $.ajax({
      url  : "/admin/promotion/get",
      type : "get",
      success : function (response){
        const res = JSON.parse(response);
        console.log("----------")
        console.log(res)
        $("#promo-image").attr("src", "${pageContext.request.contextPath}/assets/uploads/"+ res[0].image_src);
        $("#end-date").val(res[0].end_date);
        $("#start-date").val(res[0].start_date);
        $("#posentage").val(res[0].percentage);
      },
      error : function (error){
        toastError("Connection failed !!!")
      }
    })
  }
  // get all rooms
  // getAllRooms()
  function getAllRooms() {
    var ulRoomsHtml = '';
    $.ajax({
      url  : "/admin/room/get",
      type : "get",
      success : function (response){
        const res = JSON.parse(response);
        res.forEach((item) => {
          console.log(item.room_number)
          ulRoomsHtml += '<li class="w-full"> <div class="flex items-center pl-3">';
          ulRoomsHtml +='<input id="vue-checkbox-list" type="checkbox" value="' + item.id_room + '" class="w-4 h-4 bg-green-100 text-green-500 rounded checked:bg-green-500 focus:ring-green-500 focus:bg-green-500"';
          item.promo_id ? ulRoomsHtml +='checked>' : '>'
          ulRoomsHtml +='<label for="vue-checkbox-list" class="py-3 ml-2 w-full text-sm font-medium text-gray-900">' + item.room_number + '</label>';
          ulRoomsHtml +='</div> </li>';
        })
        $("#allRooms").html(ulRoomsHtml);
      },
      error : function (error){
        toastError("Connection failed !!!")
      }
    })
  }
  // validate add promotion
  validateAddPromotion();
  function validateAddPromotion(percentage, startDate, endDate, roomsId) {
    if(percentage == 0 || startDate == "" || endDate == "" || roomsId.length == 0) return 0
    return 1
  }
  // add promotion
 function addPromotion() {
    const formData = new FormData();
    let file = $("#file-upload")[0].files[0]
    let percentage = $("#posentage").val()
    let startDate = $("#start-date").val()
    let endDate = $("#end-date").val()
    var roomsId = Array();
    $('input[type=checkbox]:checked').each(function () {
      let sThisVal = (this.checked ? $(this).val() : "");
      roomsId.push(sThisVal)
    });
   let isValidat = validateAddPromotion(percentage, startDate, endDate, roomsId);
   if(isValidat == 1) {
     file ? formData.append("statusFile", "true") : formData.append("statusFile", "false")
     formData.append("fileSrc", file)
     formData.append("percentageParam", percentage)
     formData.append("startDateParam", startDate)
     formData.append("endDateParam", endDate)
     formData.append("roomsParam", JSON.stringify(roomsId))
     $("#loadingUpdate").show()
     $("#loadingNotes").show()
     $.ajax({
       url : "/admin/promotion/update",
       type: "post",
       data: formData,
       processData: false,
       contentType: false,
       enctype: 'multipart/form-data',
       success : function (response){
         const res = JSON.parse(response);
         $("#promo-image").attr("src", "${pageContext.request.contextPath}/assets/uploads/"+ res.src)
         $("#loadingUpdate").hide()
         $("#loadingNotes").hide()
         toastSuccess("Promotion added successfully.")
       },
       error : function (error){
         toastError("Connection failed !!!.")
       }
     })
   }else {
     toastError("All informations required.")
   }
  }

  function toastSuccess(message) {
    let   element ='<div class="inline-flex flex-shrink-0 justify-center items-center w-8 h-8 text-green-500 bg-green-100 rounded-lg">'
    element +='<svg aria-hidden="true" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>'
    element +='<span class="sr-only text-gray-600">Check icon</span></div>'
    element +='<div class="ml-3 text-sm font-normal">'
    element += message + ' </div>'
    $("#toast-success").html(element)
    $("#toast-success").addClass("bg-green-200")
    $("#toast-success").removeClass("bg-red-200")
    $("#toast-success").show(100)
    setTimeout(function () {
      $("#toast-success").hide()
    },3000)
  }

  function toastError(message) {
    let   element ='<div class="inline-flex flex-shrink-0 justify-center items-center w-8 h-8 text-red-500 bg-red-100 rounded-lg">'
    element +='<svg aria-hidden="true" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>'
    element +='<span class="sr-only text-gray-600">Check icon</span></div>'
    element +='<div class="ml-3 text-sm font-normal">'
    element += message + ' </div>'
    $("#toast-success").html(element)
    $("#toast-success").addClass("bg-red-200")
    $("#toast-success").removeClass("bg-green-200")
    $("#toast-success").show(100)
    setTimeout(function () {
      $("#toast-success").hide()
    },3000)
  }

</script>
</body>
</html>
